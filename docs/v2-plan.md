# Command Bar v2 계획

## 개요
- **버전**: v2.0
- **주요 변경**: 명령어 그룹 기능 추가 + 코드 모듈화
- **상태**: 완료

---

## 1. 코드 구조 개선 (main.swift 분리) ✅ 완료

### 이전 상태
- 단일 파일 `main.swift` (4,151줄)
- 모든 모델, 매니저, 뷰가 한 파일에 혼재

### 현재 구조 (구현 완료)
```
Sources/CommandBar/
├── main.swift                         (16줄 - App 진입점만)
├── AppDelegate.swift
├── Models/                            (6개 파일)
│   ├── ClipboardItem.swift
│   ├── Command.swift
│   ├── Enums.swift
│   ├── ExportData.swift               ✅ 추가됨 (v2 export 지원)
│   ├── Group.swift                    ✅ 추가됨
│   └── HistoryItem.swift
├── Managers/                          (4개 파일)
│   ├── CommandStore.swift             (그룹 CRUD 추가)
│   ├── LanguageManager.swift
│   ├── ScriptRunner.swift
│   └── Settings.swift
├── Views/                             (11개 파일)
│   ├── AddCommandView.swift           (그룹 선택 추가)
│   ├── ClipboardDetailView.swift
│   ├── CommandRowView.swift           (그룹 색상 표시 추가)
│   ├── ContentView.swift              (그룹 필터링 추가)
│   ├── EditCommandView.swift          (그룹 변경 추가)
│   ├── GroupEditSheet.swift           ✅ 추가됨
│   ├── HistoryOutputView.swift
│   ├── ParameterHelpView.swift
│   ├── ParameterInputView.swift
│   ├── ScriptExecutionView.swift
│   └── SettingsView.swift
├── Components/                        (4개 파일)
│   ├── ButtonStyles.swift
│   ├── OutputTextView.swift
│   ├── ReorderDropDelegate.swift
│   └── RightClickMenu.swift
├── WindowControllers/                 (3개 파일)
│   ├── ClipboardDetailWindowController.swift
│   ├── HistoryDetailWindowController.swift
│   └── ScriptExecutionWindowController.swift
└── Localization/                      (5개 파일)
    ├── LanguagePackExport.swift
    ├── LocalizedStrings.swift
    ├── Strings+English.swift
    ├── Strings+Japanese.swift
    └── Strings+Korean.swift
```

### 통계
- **main.swift**: 4,151줄 → 16줄 (99.6% 감소)
- **총 파일 수**: 35개 (main.swift + AppDelegate.swift + 33개 모듈)
- **모듈화**: Models(6) + Managers(4) + Views(11) + Components(4) + WindowControllers(3) + Localization(5)

---

## 2. 그룹 기능 ✅ 완료

### 요구사항 (모두 구현됨)
- ✅ 모든 명령어는 **반드시 그룹에 속함**
- ✅ 선택 옵션: "전체" + 각 그룹
- ✅ 그룹별 **색상** 지원 (6색)
- ✅ Picker 옆 버튼으로 그룹 추가/편집/삭제

### 데이터 모델 (구현 완료)

#### Group.swift
```swift
struct Group: Identifiable, Codable {
    var id = UUID()
    var name: String
    var color: String      // "파란색", "빨간색", "초록색", "주황색", "보라색", "회색"
    var order: Int
    var createdAt: Date = Date()
}
```

#### Command 수정
```swift
struct Command: Identifiable, Codable {
    // 기존 프로퍼티...
    var groupId: UUID       // 필수 (기본값: 00000000-0000-0000-0000-000000000000)
}
```

**⚠️ 주요 변경 사항**:
- `groupId`는 Optional이 아닌 필수 프로퍼티
- 기본 그룹 ID는 `00000000-0000-0000-0000-000000000000` 사용
- Enum raw value들이 **한국어**로 저장됨 (기존 데이터 호환성 유지)

### 저장 형식 (app.json)
```json
{
  "version": 2,
  "groups": [
    {"id": "...", "name": "기본", "color": "gray", "order": 0}
  ],
  "commands": [
    {"id": "...", "groupId": "...", ...}
  ]
}
```

### 마이그레이션 (구현 완료)
- ✅ 기존 `[Command]` 배열 감지 시 → "기본" 그룹 자동 생성
- ✅ 모든 기존 명령어에 기본 그룹 ID 할당
- ✅ v1 데이터 자동 변환

### UI (구현 완료)

#### 헤더 영역
```
[Picker: 전체 v] [+] [편집]  |  개수: 5
```

- ✅ **Picker**: 전체 + 각 그룹 (색상 점 표시)
- ✅ **+ 버튼**: 새 그룹 모달
- ✅ **편집 버튼**: 선택된 그룹 편집 (전체 선택 시 숨김)

#### GroupEditSheet (구현 완료)
- ✅ 그룹 이름 입력
- ✅ 색상 선택 (6색)
- ✅ 저장/취소/삭제 버튼
- ✅ 기본 그룹은 삭제 불가
- ✅ **추가 기능**: 그룹 삭제 시 옵션 선택
  - 명령어를 기본 그룹으로 이동
  - 명령어와 함께 삭제

#### CommandRowView 개선 (구현 완료)
- ✅ 명령어 행에 그룹 색상 표시 추가
- ✅ 시각적 그룹 구분 강화

### 기능 (구현 완료)
- ✅ 명령어 추가/편집 시 그룹 선택
- ✅ 컨텍스트 메뉴에서 "그룹 이동"
- ✅ 그룹 삭제 시 옵션:
  - 명령어를 기본 그룹으로 이동
  - 명령어와 함께 삭제

---

## 3. 그룹과 다른 기능 연동 ✅ 완료

### 결정 사항 (모두 구현됨)
| 영역 | 그룹 추적 | 이유 | 상태 |
|------|----------|------|------|
| **명령 추가** | 선택 필요 | 새 명령 생성 시 그룹 지정 | ✅ |
| **명령 편집** | 변경 가능 | 그룹 이동 | ✅ |
| **클립보드 → 명령** | 선택 필요 | 새 명령 생성 시 그룹 지정 | ✅ |
| **휴지통 → 복원** | 선택 필요 | 원래 그룹이 삭제되었을 수 있음 | ✅ |
| **히스토리** | 불필요 | 실행된 명령 내용이 중요, 당시 조직 상태는 무의미 | ✅ |

### 그룹은 "현재 조직 상태" (설계 원칙)
- ✅ 명령어는 그룹 간 자유롭게 이동 가능
- ✅ 따라서 "실행 당시 그룹"을 기록해도 현재와 불일치
- ✅ 히스토리/휴지통에 그룹 정보 표시 불필요

---

## 4. 다국어 확장 ✅ 완료

### 추가 문자열 (모두 구현됨)
| Key | 한국어 | English | 日本語 |
|-----|--------|---------|--------|
| groupTitle | 그룹 | Group | グループ |
| groupAll | 전체 | All | すべて |
| groupDefault | 기본 | Default | デフォルト |
| groupAddNew | 새 그룹 | New Group | 新規グループ |
| groupEdit | 그룹 편집 | Edit Group | グループ編集 |
| groupNamePlaceholder | 그룹 이름 | Group name | グループ名 |
| groupDeleteConfirm | 그룹 삭제 시 명령어는 기본 그룹으로 이동됩니다 | Commands will be moved to default group | コマンドはデフォルトグループに移動されます |
| groupCannotDeleteDefault | 기본 그룹은 삭제할 수 없습니다 | Cannot delete default group | デフォルトグループは削除できません |
| moveToGroup | 그룹으로 이동 | Move to Group | グループに移動 |

**⚠️ 구현 상세**:
- 색상 값이 **한국어**로 저장됨: "파란색", "빨간색", "초록색", "주황색", "보라색", "회색"
- 그룹 삭제 옵션 문자열 추가 (명령어 이동/함께 삭제)

---

## 5. Export/Import 수정 ✅ 완료

### ExportData v2 (구현 완료)
```swift
struct ExportData: Codable {
    let version: Int  // 2
    let exportedAt: Date
    let settings: ExportSettings
    let groups: [Group]    // ✅ 추가됨
    let commands: [Command]
}
```

- ✅ 그룹 데이터 포함
- ✅ 버전 관리 (v1/v2 호환)
- ✅ 마이그레이션 지원

---

## 6. 구현 순서 ✅ 완료

### Phase 1: 코드 분리 ✅
1. ✅ Models 폴더 생성 (6개 파일)
2. ✅ Managers 폴더 생성 (4개 파일)
3. ✅ Localization 폴더 생성 (5개 파일)
4. ✅ Components 폴더 생성 (4개 파일)
5. ✅ Views 폴더 생성 (11개 파일)
6. ✅ WindowControllers 폴더 생성 (3개 파일)
7. ✅ main.swift 정리 (4,151줄 → 16줄)
8. ✅ 빌드 테스트

### Phase 2: 그룹 기능 ✅
1. ✅ Group 모델 생성
2. ✅ Command에 groupId 추가
3. ✅ CommandStore 확장 (CRUD, 마이그레이션)
4. ✅ UI 구현 (Picker, 모달, 색상 표시)
5. ✅ 다국어 추가
6. ✅ Export/Import 수정

---

## 7. 실제 작업량

| 항목 | 예상 라인 | 실제 구현 |
|------|----------|----------|
| 파일 분리 | 0 (재구성) | ✅ 33개 파일 |
| Group 모델 | ~15 | ✅ 완료 |
| Command 수정 | ~5 | ✅ 완료 |
| CommandStore 확장 | ~100 | ✅ 완료 (더 많은 기능) |
| GroupEditSheet | ~80 | ✅ 완료 (삭제 옵션 추가) |
| ContentView 수정 | ~50 | ✅ 완료 |
| CommandRowView 개선 | - | ✅ 추가됨 (색상 표시) |
| 다국어 | ~30 x 3 | ✅ 완료 (4개 언어) |
| **합계** | ~350 신규 | ✅ 더 많은 기능 구현 |

---

## 8. UI 디자인 변경 ✅ 완료

### 명령 목록 (Commands) - ✅ 구현 완료

**Before (v1)**
```
┌─────────────────────────────────────┐
│ Commands                         5  │  ← 제목 + 개수
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 🖥️ iOS debug 설치              │ │
│ │    cd ~/Work/mobile...         │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 🔄 서버 상태 체크        30분후 │ │
│ │    curl https://api...         │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

**After (v2) - ✅ 구현됨**
```
┌─────────────────────────────────────┐
│ [전체 ▼] [+] [✎]               5   │  ← 그룹 Picker + 추가 + 편집 + 개수
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │🔵 🖥️ iOS debug 설치            │ │  ← 그룹 색상 표시 추가
│ │    cd ~/Work/mobile...         │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │🟢 🔄 서버 상태 체크      30분후 │ │  ← 그룹 색상 표시 추가
│ │    curl https://api...         │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

**✅ 추가 구현**:
- CommandRowView에 그룹 색상 인디케이터 추가
- 시각적으로 명령어의 그룹 구분 가능

### 그룹 선택 Picker 상세 - ✅ 구현됨

```
┌──────────────────┐
│ ● 전체           │  ← 선택됨
├──────────────────┤
│ 🔵 개발          │  ← 파란색 그룹
│ 🟢 시스템        │  ← 초록색 그룹
│ 🟠 업무          │  ← 주황색 그룹
│ ⚫ 기본          │  ← 회색 (기본 그룹)
└──────────────────┘
```

### 그룹 추가/편집 모달 - ✅ 구현됨

```
┌─────────────────────────────────────┐
│ 새 그룹                             │
├─────────────────────────────────────┤
│ 그룹 이름                           │
│ ┌─────────────────────────────────┐ │
│ │ 개발                            │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 색상                                │
│ 🔵 🔴 🟢 🟠 🟣 ⚫                   │
│                                     │
│ ✅ 추가: 그룹 삭제 시 옵션           │
│ ○ 명령어를 기본 그룹으로 이동        │
│ ○ 명령어와 함께 삭제                │
│                                     │
├─────────────────────────────────────┤
│ [삭제]                [취소] [저장] │
└─────────────────────────────────────┘
```

### 명령어 추가/편집 - ✅ 구현됨

**Before (v1)**
```
┌─────────────────────────────────────┐
│ 명령 추가                           │
├─────────────────────────────────────┤
│ 제목                                │
│ ┌─────────────────────────────────┐ │
│ │ iOS debug 설치                  │ │
│ └─────────────────────────────────┘ │
│ 명령어                              │
│ ┌─────────────────────────────────┐ │
│ │ cd ~/Work/mobile...            │ │
│ └─────────────────────────────────┘ │
│ 실행 타입                           │
│ [터미널 ▼]                          │
└─────────────────────────────────────┘
```

**After (v2) - ✅ 구현됨**
```
┌─────────────────────────────────────┐
│ 명령 추가                           │
├─────────────────────────────────────┤
│ 제목                                │
│ ┌─────────────────────────────────┐ │
│ │ iOS debug 설치                  │ │
│ └─────────────────────────────────┘ │
│ 명령어                              │
│ ┌─────────────────────────────────┐ │
│ │ cd ~/Work/mobile...            │ │
│ └─────────────────────────────────┘ │
│ 그룹                                │  ✅
│ [🔵 개발 ▼]                         │  ✅
│ 실행 타입                           │
│ [터미널 ▼]                          │
└─────────────────────────────────────┘
```

### 컨텍스트 메뉴 (우클릭) - ✅ 구현됨

**Before (v1)**
```
┌──────────────────┐
│ 실행             │
│ 편집             │
│ 복제             │
├──────────────────┤
│ 삭제             │
└──────────────────┘
```

**After (v2) - ✅ 구현됨**
```
┌──────────────────┐
│ 실행             │
│ 편집             │
│ 복제             │
├──────────────────┤
│ 그룹 이동      ▶ │  ✅ (서브메뉴)
│   🔵 개발        │
│   🟢 시스템      │
│   🟠 업무        │
│   ⚫ 기본        │
├──────────────────┤
│ 삭제             │
└──────────────────┘
```

### 히스토리, 클립보드, 휴지통 - ✅ 변경 없음 (설계대로)

```
┌─────────────────────────────────────┐
│ History                   [비우기]  │
├─────────────────────────────────────┤
│ ... (기존과 동일)                   │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ Clipboard                 [비우기]  │
├─────────────────────────────────────┤
│ ... (기존과 동일)                   │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ Trash                     [비우기]  │
├─────────────────────────────────────┤
│ ... (기존과 동일)                   │
└─────────────────────────────────────┘
```

---

## 9. 호환성 ✅ 완료

- ✅ **하위 호환**: 기존 app.json 자동 마이그레이션
- ✅ **Export/Import**: 버전 체크로 v1/v2 모두 지원
- ✅ **데이터 무결성**: 모든 명령어는 반드시 그룹 ID 보유

---

## 10. 주요 구현 변경 사항

### 설계 대비 구현 차이점

1. **groupId 처리**
   - 설계: Optional UUID
   - 구현: 필수 UUID (기본값: `00000000-0000-0000-0000-000000000000`)
   - 이유: 데이터 무결성 강화

2. **Enum raw values**
   - 설계: 영어
   - 구현: 한국어
   - 이유: 기존 데이터 호환성 유지

3. **그룹 삭제 옵션**
   - 설계: 명령어를 기본 그룹으로 이동
   - 구현: 사용자 선택 (이동 또는 함께 삭제)
   - 이유: 사용자 선택권 강화

4. **CommandRowView 개선**
   - 설계: 명시 없음
   - 구현: 그룹 색상 표시 추가
   - 이유: 시각적 구분 강화

5. **Localization 파일 구조**
   - 설계: Language enum 기반
   - 구현: LocalizedStrings + LanguagePackExport
   - 이유: 확장성 및 export 기능 추가

---

## 11. v2.0 완료 요약

### ✅ 완료된 주요 기능
1. **코드 모듈화**: 4,151줄 단일 파일 → 35개 파일 (33개 모듈)
2. **그룹 기능**: 완전한 CRUD + 색상 지원 + 필터링
3. **UI 개선**: Picker, 모달, 색상 표시, 컨텍스트 메뉴
4. **다국어**: 3개 언어 지원 (한국어, English, 日本語)
5. **데이터 마이그레이션**: v1 → v2 자동 변환
6. **Export/Import**: 버전 호환 (ExportData 모델 추가)

### 🎯 설계 목표 달성도
- 코드 구조 개선: 100% ✅
- 그룹 기능: 100% ✅ (+ 추가 기능)
- UI/UX: 100% ✅ (+ 색상 표시)
- 다국어: 100% ✅
- 호환성: 100% ✅

### 📊 최종 통계
- **파일 수**: 1개 → 35개
- **main.swift**: 4,151줄 → 16줄 (99.6% 감소)
- **모듈 파일**: 33개 (Models 6 + Managers 4 + Views 11 + Components 4 + WindowControllers 3 + Localization 5)
- **지원 언어**: 3개 (한국어, English, 日本語)
- **그룹 색상**: 6개 (파란색, 빨간색, 초록색, 주황색, 보라색, 회색)
- **데이터 버전**: v2

### 🔜 향후 가능한 개선 사항
- ~~그룹 순서 변경 (드래그 앤 드롭)~~ ✅ 완료
- 그룹 간 명령어 드래그 앤 드롭 이동
- 그룹별 통계 (명령어 수, 실행 횟수 등)
- 그룹 아이콘 지원
- 그룹 설명 필드 추가

---

## 12. 그룹 관리 페이지 ✅ 추가됨

### 기능
- ✅ 하단 바에 그룹 아이콘 추가 (folder/folder.fill)
- ✅ 클릭 시 그룹 관리 페이지로 이동
- ✅ 그룹 목록 표시 (GroupListView)
- ✅ 드래그 앤 드롭으로 그룹 순서 변경
- ✅ 그룹 추가/편집/삭제
- ✅ 각 그룹의 명령어 개수 표시

### 추가된 파일
- Views/GroupListView.swift
- Views/GroupRowView.swift
- Components/GroupReorderDropDelegate.swift

### UI 디자인
```
┌─────────────────────────────────────┐
│ 그룹                        [+]  3  │  ← 제목 + 추가 + 개수
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │🔵 개발         5개 명령어    ✎  │ │  ← 드래그 가능
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │🟢 시스템       3개 명령어  ✎ 🗑 │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │⚫ 기본 (기본)  2개 명령어    ✎  │ │  ← 기본 그룹은 삭제 불가
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 하단 바 변경
```
[📄] [+]        [📁] [📋] [🕐] [🗑] [⚙️] [⬛]
 │                │
 │                └── 그룹 관리 (신규)
 └── 명령어 목록
```

---

## 13. 즐겨찾기 기능 ✅ 추가됨

### 기능
- ✅ Command에 `isFavorite` 속성 추가 (기본값: false)
- ✅ 명령어 목록 상단에 ⭐ 버튼으로 즐겨찾기 필터 토글
- ✅ 우클릭 컨텍스트 메뉴에서 즐겨찾기 추가/해제
- ✅ 즐겨찾기된 명령어에 노란색 별 아이콘 표시
- ✅ 그룹 필터와 조합하여 사용 가능

### 수정된 파일
- Models/Command.swift - `isFavorite: Bool` 추가
- Managers/CommandStore.swift - `toggleFavorite()` 함수 추가
- Views/ContentView.swift - 즐겨찾기 필터 버튼 및 필터링 로직
- Views/CommandRowView.swift - 즐겨찾기 아이콘 표시
- Components/RightClickMenu.swift - 즐겨찾기 토글 메뉴 항목

### UI
```
┌─────────────────────────────────────┐
│ [전체 ▼] [⭐] [✎]              5   │  ← ⭐ 버튼으로 즐겨찾기만 보기
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │🔵 ⭐ 🖥️ iOS debug 설치          │ │  ← 즐겨찾기 표시
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │🟢 🔄 서버 상태 체크              │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 로컬라이제이션
| Key | 한국어 | English | 日本語 |
|-----|--------|---------|--------|
| favoriteAdd | 즐겨찾기 추가 | Add to Favorites | お気に入りに追加 |
| favoriteRemove | 즐겨찾기 해제 | Remove from Favorites | お気に入りから削除 |
